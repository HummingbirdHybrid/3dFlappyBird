<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Game Template</title>
    <script src="vendor/three.js/build/three.min.js"></script>
    <script src="vendor/three.js/build/WebglSupport.js"></script>
    <script src="vendor/three.js/build/OrbitControls.js"></script>
    <script src="vendor/physijs/physi.js"></script>
    <script src="vendor/physijs/physijs_worker.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden
        }
        canvas { width: 100%; height: 100% }
    </style>
</head>
<body>
<script>
    Physijs.scripts.worker = 'vendor/physijs/physijs_worker.js';
    var scene, camera, renderer;
    var geometry, material;
    var plane,skySphere,persona,obsticle1,obsticle2;
    var sceneSpeed=1;
    if (Detector.webgl) {
            init();
            animate();
    } else {
        var warning = Detector.getWebGLErrorMessage();
        document.body.appendChild(warning);
    }
   var controls;
    function init() {

        scene = new Physijs.Scene();
        scene.setGravity(new THREE.Vector3( 0,-250, 0 ));


        camera = new THREE.PerspectiveCamera( 75, window.outerWidth / window.outerHeight, 0.1, 10000 );
        camera.position.z = 500;

        controls = new THREE.OrbitControls(camera);


        var  galaxyTexture	= THREE.ImageUtils.loadTexture('resources/galaxy_starfield.png');
        material	= new THREE.MeshBasicMaterial({
            map	: galaxyTexture,
            side	: THREE.BackSide,
            color	: 0x808080,
        });
         geometry	= new THREE.SphereGeometry(9000, 32, 32);
         skySphere	= new THREE.Mesh(geometry, material);
         scene.add(skySphere);

        light = new THREE.PointLight(0xFFFF00);
        light.position.set(100, 0, 250);
        scene.add(light);
        //#TODO:background texture
       /* geometry = new THREE.PlaneGeometry( window.innerWidth, window.innerHeight , 10, 10 );
        material = new THREE.MeshLambertMaterial(
            {
                color: 0x4BD121
            });
        plane = new THREE.Mesh(geometry,material);

        scene.add( plane );*/

        geometry = new THREE.CubeGeometry(100,100,100);
        material = new THREE.MeshLambertMaterial({
            color: 'white',
           // wireframe: true
        });

        persona = new Physijs.BoxMesh(geometry,material);
        persona.position.z=60;
        persona.position.x=-400;
        scene.add(persona);

        geometry = new THREE.CubeGeometry(100,900,100);
        material = new THREE.MeshLambertMaterial(
            {
                color:'red',

            }
        );
        obsticle1 = new THREE.Mesh(geometry,material);
        obsticle1.position.y=window.innerHeight/2;
        obsticle1.position.z = 50;
        scene.add(obsticle1);

        obsticle2 = new THREE.Mesh(geometry,material);
        obsticle2.position.y=-window.innerHeight/2;
        obsticle2.position.x=window.innerWidth/2;
        obsticle2.position.z = 50;
        scene.add(obsticle2);


        window.addEventListener('resize', function(){
            renderer.setSize( window.innerWidth, window.innerHeight );
            camera.aspect	= window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix()
        }, false);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize( window.innerWidth, window.innerHeight );



        document.body.appendChild( renderer.domElement );

    }

    window.addEventListener('keydown',function () {
      //  persona.position.y+=50;
        persona.setAngularVelocity({x: 0, y: 0, z: 0});
        var effect = new THREE.Vector3(0,350,0);
        persona.setLinearVelocity(effect);
    });

    function animate() {
    //#TODO: collision detection, falling out of area @by niowa
        requestAnimationFrame( animate );
        obsticle1.position.x-=sceneSpeed;
        obsticle2.position.x-=sceneSpeed;
        scene.simulate();
        renderer.render( scene, camera );

    }

</script>
</body>
</html>
